

<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  
  
  <title>Greenboot health check | Installing | MicroShift Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/search.css" rel="stylesheet" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/autumn.css" rel="stylesheet"  media="screen"/>
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png"/>
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css"/>
  <link href="https://assets.openshift.net/content/osh-nav-footer.css" rel="stylesheet" type="text/css" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/docs.css" rel="stylesheet"  media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/print.css" rel="stylesheet" type="text/css" media="print"/>
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">

  <!-- Adobe DTM -->
  <script src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <!-- End Adobe DTM -->

  <script id="trustarc" src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
        rel="stylesheet">

</head>

<body onload="selectVersion('Branch Build');">
  
<nav id="main">
  <div class="container">
    <div class="row">
      <div class="navbar navbar-default navbar-openshift" role="navigation">
        <div class="navbar-header">
            <a href="#nav-main" class="dropdown-toggle navbar-menu-toggle hidden visible-xs" data-toggle="collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          <a class="navbar-brand" href="/"></a>
        </div>
        <div id="nav-main" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="products" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                Products <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-column flex-md-row">
                  <div class="col-xs-12 col-sm-3">
                    <h3>Overview</h3>
                    <ul class="nav flex-column">
                      <li><a target="_blank" href="https://www.openshift.com/products/features/">Features</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/products/pricing/">Pricing</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-9">
                    <h3>Featured Products</h3>
                    <ul class="nav">
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/container-platform/">Red Hat OpenShift Container&nbsp;Platform</a>
                        <p class="d-none d-md-block">Build, deploy and manage your applications across cloud- and on-premise infrastructure</p>
                      </li>
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/dedicated/">Red Hat OpenShift Dedicated</a>
                        <p class="d-none d-md-block">Single-tenant, high-availability Kubernetes clusters in the public cloud</p>
                      </li>

                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/online/">Red Hat OpenShift Online</a>
                        <p class="d-none d-md-block">The fastest way for developers to build, host and scale applications in the public cloud</p>
                      </li>

                      <li class="nav-item">
                        <a target="_blank" href="https://www.openshift.com/products/">All products <span class="fa fa-angle-right"></span></a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li id="learn" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Learn <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-md-nowrap">
                  <div class="col-xs-12 col-sm-6">
                    <h3>Learn</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/what-is-openshift/">What is OpenShift</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/get-started/">Get started</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/partners/">Partners</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/success-stories/">Customer success stories</a></li>
                      <li><a target="_blank" href="https://blog.openshift.com">Blog</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/resources/">Resources</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <h3>Technology Topics</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/knative/">Knative</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/security/">Security</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/kubernetes/">Kubernetes</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/service-brokers/">Service Brokers</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Community <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://commons.openshift.org">OpenShift Commons</a></li>
                <li><a target="_blank" href="https://www.okd.io">Open Source (OKD)</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/startups/">Startups</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/grants/">Grants</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Support <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://help.openshift.com">Help Center</a></li>
                <li><a href="https://docs.openshift.com">OpenShift Docs</a></li>
              </ul>
            </li>

            <li><a target="_blank" class="nav-sign-up" href="https://www.openshift.com/trial/">Free Trial</a></li>

            <li><a target="_blank" href="https://console.redhat.com/openshift" class="nav-sign-in">Log In <span class="fa fa-angle-right"></span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

  
  <div class="container">
    <button id="hc-open-btn" class="open-btn-sm" onclick="openNav()" aria-label="Open"><span class="fa fa-bars" /></button>
    <ol class="breadcrumb hide-for-print">
      

      

      

      

      

      

      <li class="sitename">
        <a href="/">
          Documentation</a>
      </li>
      <li class="hidden-xs active">
        
          <a href="../microshift_welcome/index.html">MicroShift Branch Build</a>
        
      </li>
      <li class="hidden-xs active">
        <a href="../microshift_install/microshift-install-rpm.html">Installing</a>
      </li>
      
      
      <li class="hidden-xs active">
        Greenboot health check
      </li>
      
      <span text-align="right" style="float: right !important">
        <a href="https://github.com/openshift/openshift-docs/commits/main/microshift_install/microshift-greenboot.adoc"><span class="material-icons-outlined" title="Page history">history</span></a>
        
        <a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&issuetype=1&components=12367614&priority=4&summary=[microshift-Branch Build]+Issue+in+file+microshift_install/microshift-greenboot.adoc">
          <span class="material-icons-outlined" title="Open an issue">bug_report</span>
        </a>
        <a href="javascript: void(0);" onclick="window.print()"><span class="material-icons-outlined" title="Print page (Save as PDF)">picture_as_pdf</span></a>
        
        
      </span>
      
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas hide-for-print">
        <div class="row-fluid">
          <div id="btn-close">
            <button id="hc-close-btn" onclick="closeNav()" class="close-btn-sm" aria-label="close"><span class="fa fa-times" /></button>
          </div>
          <div id="hc-search">
            <input id="hc-search-input" type="text" aria-label="search">
            <button id="hc-search-btn" aria-label="search"><span class="fa fa-search" /></button>
          </div>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0"><span id="tgSpan0" class="fa fa-angle-right"></span>About</a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_welcome/index.html">Welcome</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1"><span id="tgSpan1" class="fa fa-angle-right"></span>Release notes</a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_release_notes/microshift-4-14-release-notes.html">MicroShift 4.14 release notes</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2"><span id="tgSpan2" class="fa fa-angle-right"></span>Getting started</a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_getting_started/microshift-understanding.html">Understanding MicroShift</a></li>
            <li><a class="" href="../microshift_getting_started/microshift-architecture.html">Architecture</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3"><span id="tgSpan3" class="fa fa-angle-down"></span>Installing</a>
      <ul id="topicGroup3" class="collapse in list-unstyled">
            <li><a class="" href="../microshift_install/microshift-install-rpm.html">Installing from RPM</a></li>
            <li><a class="" href="../microshift_install/microshift-embed-in-rpm-ostree.html">Embedding in a RHEL for Edge image</a></li>
            <li><a class=" active" href="../microshift_install/microshift-greenboot.html">Greenboot health check</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4"><span id="tgSpan4" class="fa fa-angle-right"></span>Updating clusters</a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_updating/microshift-about-updates.html">About MicroShift updates</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5"><span id="tgSpan5" class="fa fa-angle-right"></span>Support</a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_support/microshift-etcd.html">MicroShift etcd</a></li>
            <li><a class="" href="../microshift_support/microshift-sos-report.html">MicroShift sos report</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6"><span id="tgSpan6" class="fa fa-angle-right"></span>API reference</a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_rest_api/understanding-api-support-tiers.html">Understanding API tiers</a></li>
            <li><a class="" href="../microshift_rest_api/understanding-compatibility-guidelines.html">API compatibility guidelines</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-2"><span id="sgSpan-6-2" class="fa fa-caret-right"></span>&nbsp;Network APIs</a>
              <ul id="topicSubGroup-6-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../microshift_rest_api/network_apis/route-route-openshift-io-v1.html">Route [route.openshift.io/v1]</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-3"><span id="sgSpan-6-3" class="fa fa-caret-right"></span>&nbsp;Security APIs</a>
              <ul id="topicSubGroup-6-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../microshift_rest_api/security_apis/securitycontextconstraints-security-openshift-io-v1.html">SecurityContextConstraints [security.openshift.io/v1]</a></li>              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7"><span id="tgSpan7" class="fa fa-angle-right"></span>CLI tools</a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_cli_ref/microshift-cli-tools-introduction.html">CLI tools introduction</a></li>
            <li><a class="" href="../microshift_cli_ref/microshift-oc-cli-install.html">Installing the OpenShift CLI</a></li>
            <li><a class="" href="../microshift_cli_ref/microshift-oc-config.html">Configuring the OpenShift CLI</a></li>
            <li><a class="" href="../microshift_cli_ref/microshift-cli-using-oc.html">Using the OpenShift CLI</a></li>
            <li><a class="" href="../microshift_cli_ref/microshift-usage-oc-kubectl.html">Using oc and kubectl</a></li>
            <li><a class="" href="../microshift_cli_ref/microshift-oc-cli-commands-list.html">List of oc CLI commands</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8"><span id="tgSpan8" class="fa fa-angle-right"></span>Configuring</a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_configuring/microshift-using-config-tools.html">Using configuration tools</a></li>
            <li><a class="" href="../microshift_configuring/microshift-cluster-access-kubeconfig.html">Cluster access with kubeconfig</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup9"><span id="tgSpan9" class="fa fa-angle-right"></span>Networking</a>
      <ul id="topicGroup9" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_networking/microshift-networking.html">Networking settings</a></li>
            <li><a class="" href="../microshift_networking/microshift-firewall.html">Firewall configuration</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup10"><span id="tgSpan10" class="fa fa-angle-right"></span>Storage</a>
      <ul id="topicGroup10" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_storage/index.html">MicroShift storage overview</a></li>
            <li><a class="" href="../microshift_storage/understanding-ephemeral-storage-microshift.html">Understanding ephemeral storage for MicroShift</a></li>
            <li><a class="" href="../microshift_storage/generic-ephemeral-volumes-microshift.html">Generic ephemeral volumes for MicroShift</a></li>
            <li><a class="" href="../microshift_storage/understanding-persistent-storage-microshift.html">Understanding persistent storage for MicroShift</a></li>
            <li><a class="" href="../microshift_storage/expanding-persistent-volumes-microshift.html">Expanding persistent volumes for MicroShift</a></li>
            <li><a class="" href="../microshift_storage/microshift-storage-plugin-overview.html">Dynamic storage using the LVMS plugin</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup11"><span id="tgSpan11" class="fa fa-angle-right"></span>Running applications</a>
      <ul id="topicGroup11" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_running_apps/microshift-applications.html">Application deployment</a></li>
            <li><a class="" href="../microshift_running_apps/microshift-operators.html">Operators</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup12"><span id="tgSpan12" class="fa fa-angle-right"></span>Troubleshooting</a>
      <ul id="topicGroup12" class="collapse  list-unstyled">
            <li><a class="" href="../microshift_troubleshooting/microshift-version.html">Checking your version</a></li>
            <li><a class="" href="../microshift_troubleshooting/microshift-things-to-know.html">Additional information</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div id="hc-search-modal">
        <div id="hc-modal-content">
          <span id="hc-modal-close">&times;</span>
          <div id="hc-search-results-wrapper">
            <div id="hc-search-results"></div>
            <div id="hc-search-progress-indicator" class="text-center search-progress-indicator"><i class="fa fa-circle-o-notch fa-spin" style="font-size:42px"></i></div>
            <div class="text-center">
              <button id="hc-search-more-btn">Show more results</button>
            </div>
          </div>
        </div>
      </div>
      <div class="print-logo" style="display:none;">
        <img src="https://www.redhat.com/cms/managed-files/Logo-Red_Hat-OpenShift-A-Standard-RGB_0_0.svg" alt="print logo"/>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>
            The greenboot health check
          </h1>
        </div>
        
        
        <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#microshift-greenboot-dir-structure_microshift-greenboot">How greenboot uses directories to run scripts</a>
<ul class="sectlevel2">
<li><a href="#greenboot-directories-details_microshift-greenboot">Greenboot directories details</a></li>
</ul>
</li>
<li><a href="#microshift-health-script_microshift-greenboot">The MicroShift health script</a>
<ul class="sectlevel2">
<li><a href="#validation-wait-period">Validation wait period</a></li>
</ul>
</li>
<li><a href="#microshift-greenboot-systemd-journal-data_microshift-greenboot">Enabling systemd journal service data persistency</a></li>
<li><a href="#microshift-greenboot-updates-workloads_microshift-greenboot">Updates and third-party workloads</a></li>
<li><a href="#microshift-greenboot-workloads-validation_microshift-greenboot">Checking the results of an update</a></li>
<li><a href="#microshift-greenboot-access-health-check_microshift-greenboot">Accessing health check output in the system log</a></li>
<li><a href="#microshift-greenboot-access-prerollback-check_microshift-greenboot">Accessing prerollback health check output in the system log</a></li>
<li><a href="#greenboot-check-updates_microshift-greenboot">Checking updates with a health script</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>Greenboot is the generic health check framework for the <code>systemd</code> service on RPM-OSTree-based systems. The <code>microshift-greenboot</code> RPM and <code>greenboot-default-health-check</code> are optional RPM packages you can install. Greenboot is used to assess system health and automate a rollback to the last healthy state in the event of software trouble.</p>
</div>
<div class="paragraph">
<p>This health check framework is especially useful when you need to check for software problems and perform system rollbacks on edge devices where direct serviceability is either limited or non-existent. When health check scripts are installed and configured, health checks run every time the system starts.</p>
</div>
<div class="paragraph">
<p>Using greenboot can reduce your risk of being locked out of edge devices during updates and prevent a significant interruption of service if an update fails. When a failure is detected, the system boots into the last known working configuration using the <code>rpm-ostree</code> rollback capability.</p>
</div>
<div class="paragraph">
<p>A MicroShift health check script is included in the <code>microshift-greenboot</code> RPM. The <code>greenboot-default-health-check</code> RPM includes health check scripts verifying that DNS and <code>ostree</code> services are accessible. You can also create your own health check scripts based on the workloads you are running. You can write one that verifies that an application has started, for example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rollback is not possible in the case of an update failure on a system not using OSTree. This is true even though health checks might run.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-greenboot-dir-structure_microshift-greenboot"><a class="anchor" href="#microshift-greenboot-dir-structure_microshift-greenboot"></a>How greenboot uses directories to run scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Health check scripts run from four <code>/etc/greenboot</code> directories. These scripts run in alphabetical order. Keep this in mind when you configure the scripts for your workloads.</p>
</div>
<div class="paragraph">
<p>When the system starts, greenboot runs the scripts in the <code>required.d</code> and <code>wanted.d</code> directories. Depending on the outcome of those scripts, greenboot continues the startup or attempts a rollback as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>System as expected: When all of the scripts in the <code>required.d</code> directory are successful, greenboot runs any scripts present in the <code>/etc/greenboot/green.d</code> directory.</p>
</li>
<li>
<p>System trouble: If any of the scripts in the <code>required.d</code> directory fail, greenboot runs any prerollback scripts present in the <code>red.d</code> directory, then restarts the system.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Greenboot redirects script and health check output to the system log. When you are logged in, a daily message provides the overall system health output.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="greenboot-directories-details_microshift-greenboot"><a class="anchor" href="#greenboot-directories-details_microshift-greenboot"></a>Greenboot directories details</h3>
<div class="paragraph">
<p>Returning a nonzero exit code from any script means that script has failed. Greenboot restarts the system a few times to retry the scripts before attempting to roll back to the previous version.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/greenboot/check/required.d</code> contains the health checks that must not fail.</p>
<div class="ulist">
<ul>
<li>
<p>If the scripts fail, greenboot retries them three times by default. You can configure the number of retries in the <code>/etc/greenboot/greenboot.conf</code> file by setting the <code>GREENBOOT_MAX_BOOTS</code> parameter to the desired number of retries.</p>
</li>
<li>
<p>After all retries fail, greenboot automatically initiates a rollback if one is available. If a rollback is not available, the system log output shows that manual intervention is required.</p>
</li>
<li>
<p>The <code>40_microshift_running_check.sh</code> health check script for MicroShift is installed into this directory.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>/etc/greenboot/check/wanted.d</code> contains health scripts that are allowed to fail without causing the system to be rolled back.</p>
<div class="ulist">
<ul>
<li>
<p>If any of these scripts fail, greenboot logs the failure but does not initiate a rollback.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>/etc/greenboot/green.d</code> contains scripts that run after greenboot has declared the start successful.</p>
</li>
<li>
<p><code>/etc/greenboot/red.d</code> contains scripts that run after greenboot has declared the startup as failed, including the <code>40_microshift_pre_rollback.sh</code> prerollback script. This script is executed right before a system rollback. The script performs MicroShift pod and OVN-Kubernetes cleanup to avoid potential conflicts after the system is rolled back to a previous version.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-health-script_microshift-greenboot"><a class="anchor" href="#microshift-health-script_microshift-greenboot"></a>The MicroShift health script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>40_microshift_running_check.sh</code> health check script only performs validation of core MicroShift services. Install your customized workload validation scripts in the greenboot directories to ensure successful application operations after system updates. Scripts run in alphabetical order.</p>
</div>
<div class="paragraph">
<p>MicroShift health checks are listed in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Validation statuses and outcome for MicroShift</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Validation</th>
<th class="tableblock halign-left valign-top">Pass</th>
<th class="tableblock halign-left valign-top">Fail</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check that the script runs with <code>root</code> permissions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check that the <code>microshift.service</code> is enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait for the <code>microshift.service</code> to be active (!failed)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait for Kubernetes API health endpoints to be working and receiving traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait for any pod to start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each core namespace, wait for images to be pulled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each core namespace, wait for pods to be ready</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each core namespace, check if pods are not restarting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit 1</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="validation-wait-period"><a class="anchor" href="#validation-wait-period"></a>Validation wait period</h3>
<div class="paragraph">
<p>The wait period in each validation is five minutes by default. After the wait period, if the validation has not succeeded, it is declared a failure. This wait period is incrementally increased by the base wait period after each boot in the verification loop.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can override the base-time wait period by setting the <code>MICROSHIFT_WAIT_TIMEOUT_SEC</code> environment variable in the <code>/etc/greenboot/greenboot.conf</code> configuration file. For example, you can change the wait time to three minutes by resetting the value to 180 seconds, such as <code>MICROSHIFT_WAIT_TIMEOUT_SEC=180</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-greenboot-systemd-journal-data_microshift-greenboot"><a class="anchor" href="#microshift-greenboot-systemd-journal-data_microshift-greenboot"></a>Enabling systemd journal service data persistency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default configuration of the <code>systemd</code> journal service stores the data in the volatile <code>/run/log/journal</code> directory. To persist system logs across system starts and restarts, you must enable log persistence and set limits on the maximal journal data size.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Make the directory by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/systemd/journald.conf.d</code></pre>
</div>
</div>
</li>
<li>
<p>Create the configuration file by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">cat &lt;&lt;EOF | sudo tee /etc/systemd/journald.conf.d/microshift.conf &amp;&gt;</span>/dev/null
<span class="go">[Journal]
Storage=persistent
SystemMaxUse=1G
RuntimeMaxUse=1G
EOF</span></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the configuration file values for your size requirements.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="../microshift_running_apps/microshift-applications.html#microshift-manifests-example_applications-microshift">Auto applying manifests</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-greenboot-updates-workloads_microshift-greenboot"><a class="anchor" href="#microshift-greenboot-updates-workloads_microshift-greenboot"></a>Updates and third-party workloads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Health checks are especially useful after an update. You can examine the output of greenboot health checks and determine whether the update was declared valid. This health check can help you determine if the system is working properly.</p>
</div>
<div class="paragraph">
<p>Health check scripts for updates are installed into the <code>/etc/greenboot/check/required.d</code> directory and are automatically executed during each system start. Exiting scripts with a nonzero status means the system start is declared as failed.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Wait until after an update is declared valid before starting third-party workloads. If a rollback is performed after workloads start, you can lose data. Some third-party workloads create or update data on a device before an update is complete. Upon rollback, the file system reverts to its state before the update.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-greenboot-workloads-validation_microshift-greenboot"><a class="anchor" href="#microshift-greenboot-workloads-validation_microshift-greenboot"></a>Checking the results of an update</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After a successful start, greenboot sets the variable <code>boot_success=</code> to <code>1</code> in GRUB. You can view the overall status of system health checks after an update in the system log by using the following procedure.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To access the overall status of system health checks, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>grub2-editenv - list | <span class="nb">grep</span> ^boot_success</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example output for a successful system start</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">boot_success=1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-greenboot-access-health-check_microshift-greenboot"><a class="anchor" href="#microshift-greenboot-access-health-check_microshift-greenboot"></a>Accessing health check output in the system log</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can manually access the output of health checks in the system log by using the following procedure.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To access the results of a health check, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>journalctl <span class="nt">-o</span> <span class="nb">cat</span> <span class="nt">-u</span> greenboot-healthcheck.service</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example output of a failed health check</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="c">...
...
</span><span class="go">Running Required Health Check Scripts...
STARTED
GRUB boot variables:
boot_success=0
boot_indeterminate=0
boot_counter=2
</span><span class="c">...
...
</span><span class="go">Waiting 300s for MicroShift service to be active and not failed
FAILURE
</span><span class="c">...
...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="microshift-greenboot-access-prerollback-check_microshift-greenboot"><a class="anchor" href="#microshift-greenboot-access-prerollback-check_microshift-greenboot"></a>Accessing prerollback health check output in the system log</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can access the output of health check scripts in the system log. For example, check the results of a prerollback script using the following procedure.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To access the results of a prerollback script, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>journalctl <span class="nt">-o</span> <span class="nb">cat</span> <span class="nt">-u</span> redboot-task-runner.service</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example output of a prerollback script</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="c">...
...
</span><span class="go">Running Red Scripts...
STARTED
GRUB boot variables:
boot_success=0
boot_indeterminate=0
boot_counter=0
The ostree status:
* rhel c0baa75d9b585f3dd989a9cf05f647eb7ca27ee0dbd4b94fe8c93ed3a4b9e4a5.0
    Version: 9.1
</span><span class="gp">    origin: &lt;unknown origin type&gt;</span><span class="w">
</span><span class="go">  rhel 6869c1347b0e0ba1bbf0be750cdf32da5138a1fcbc5a4c6325ab9eb647b64663.0 (rollback)
    Version: 9.1
    origin refspec: edge:rhel/9/x86_64/edge
System rollback imminent - preparing MicroShift for a clean start
Stopping MicroShift services
Removing MicroShift pods
Killing conmon, pause and OVN processes
Removing OVN configuration
Finished greenboot Failure Scripts Runner.
Cleanup succeeded
Script '40_microshift_pre_rollback.sh' SUCCESS
FINISHED
redboot-task-runner.service: Deactivated successfully.</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="greenboot-check-updates_microshift-greenboot"><a class="anchor" href="#greenboot-check-updates_microshift-greenboot"></a>Checking updates with a health script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Access the output of health check scripts in the system log after an update by using the following procedure.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To access the result of update checks, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>grub2-editenv - list | <span class="nb">grep</span> ^boot_success</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example output for a successful update</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">boot_success=1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your command returns <code>boot_success=0</code>, either the greenboot health check is still running, or the update is a failure.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/nav-tertiary.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/hc-search.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/clipboard.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/collapsible.js" type="text/javascript"></script>
  <script>
  var dk = 'microshift';
  var version = 'Branch Build';

  var distros = {
    'openshift-origin': ['docs_origin', version],
    // specific labels are used for OSD instead of the URL filter, due to its unusual URL structure; assume v4
    'openshift-dedicated': ['docs_dedicated_v4'],
    'openshift-online': ['docs_online', version],
    'openshift-enterprise': ['docs_cp', version],
    'openshift-aro' : ['docs_aro', version],
    'openshift-rosa' : ['docs_rosa'],
    'openshift-acs' : ['docs_acs', version],
    'openshift-serverless' : ['docs_serverless', version]
  };

  // only OSD v3 docs have the version variable specified
  if (dk == "openshift-dedicated" && version == "3") {
    distros['openshift-dedicated'] = ['docs_dedicated_v3']
  }

  distros[dk] ? hcSearchCategory.apply(null, distros[dk]) : hcSearchCategory("docs");
  </script>
  <script type="text/javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $("[id^='topicGroup']").on('show.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicGroup']").on('hide.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });

    const collapsibleContent = document.getElementsByTagName("details");
    for (var i = 0; i < collapsibleContent.length; i++) {
      collapsibleContent[i].setAttribute("open", "");
    }

  });
  /*]]>*/
  </script>

  <footer id="rh">

    <div class="container">
        <div class="row">

            <div class="col-sm-2">
                <img src="https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
            </div>

            <div class="col-sm-3">
              <p class="text-nowrap">Copyright © 2023 Red Hat, Inc.</p>
            </div>



            <div class="col">
                <nav class="nav">
                    <a target="_blank" href="https://www.redhat.com/en/about/privacy-policy" class="nav-link">Privacy statement</a>
                    <a target="_blank" href="https://www.openshift.com/legal/terms/" class="nav-link">Terms of use</a>
                    <a target="_blank" href="https://www.redhat.com/en/about/all-policies-guidelines" class="nav-link">All policies and guidelines</a>
                    <a id="teconsent"></a>
                </nav>
            </div>
        </div>
    </div>
</footer>
<div id="consent_blackbar" style="z-index: 100; position: fixed"></div>



<!-- Adobe DTM -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
   _satellite.pageBottom();
}
</script>
<!-- End Adobe DTM -->

  <!-- adjust page css based on breadcrumb and/or resize -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      }
    });

    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      } else if ($(window).width() < 1008) {
        sidebar.classList.remove('wide');
        document.querySelector('#hc-search').classList.remove('wide');
        if (sidebar.classList.contains('open')) {
          sidebar.style.display = 'block';
        } else {
          sidebar.style.display = 'none';
        }
        document.querySelector('.main').style.paddingTop = '0px';
      }
    });

    function adjustSide() {
      sidebar.classList.add('wide');
      document.querySelector('#hc-search').classList.add('wide');
      sidebar.style.display = 'block';
      document.querySelector('.sidebar').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 125), 10) + "px";
      document.querySelector('#hc-search').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 95), 10) + "px";
    }

    function adjustToc() {
      if (document.querySelector('#toc') !== null) {
        document.querySelector('#toc').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      }
    }

    function adjustMain() {
      document.querySelector('html').style.scrollPaddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      document.querySelector('.main').style.paddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight - 70), 10) + "px";
    }

  </script>

  <!-- remove toc active class when page is loaded -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      var tocItems = $("#toc a");

      for (let i = 0; i < tocItems.length; i++) {
        tocItems[i].classList.remove("toc-active");
      }
    })
  </script>

  <!-- maintain sidebar scroll position between page loads -->
  <script type="text/javascript">
    let sidebar = document.querySelector(".sidebar");
    let scrolltop = localStorage.getItem("sidebar-scroll");

    if (scrolltop == null) {
      sidebar.scrollTop = parseInt(top, 10);
    }

    window.addEventListener("beforeunload", () => {
      localStorage.setItem("sidebar-scroll", sidebar.scrollTop);
    });

    window.addEventListener('load', () => {
      sidebar.scrollTo(0, scrolltop)
    })
  </script>

  <!-- open/close the nav -->
  <script type="text/javascript">
    function closeNav() {
      let sidebar = document.querySelector(".sidebar");
      sidebar.style.display = "none";
      sidebar.classList.remove('open');
    }

    function openNav() {
      let sidebar = document.querySelector(".sidebar");
      let hc_search = document.querySelector('#hc-search');
      sidebar.style.display = "block";
      sidebar.style.top = "0px";
      hc_search.style.top = 'unset';
      sidebar.classList.add('open');
    }
  </script>

  <!-- clear and add toc-active to clicked toc link -->
  <script type="text/javascript">
  $("#toc a").click(function() {
    var tocItems = $("#toc a");
    for (let i = 0; i < tocItems.length; i++) {
      tocItems[i].classList.remove("toc-active");
    }
    this.classList.add("toc-active");
  });
  </script>

  <!-- update active toc class when mouse scrolls -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener("wheel", () => {

        const ioConfiguration = {
          "rootMargin": "-120px 0px -400px 0px",
          "threshold": 0
        };

        const observer = new IntersectionObserver(setCurrent, ioConfiguration, entries => {
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            //fight with js
            document.querySelector(`#toc li a[href="#${id}"]`).classList.remove('toc-active');
          });
        });

        //track all h1-4 headings that have an id
        document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
          observer.observe(h);
        });

        //runs when the IntersectionObserver fires
        function setCurrent(e) {
          var allTocLinks = document.querySelectorAll("#toc li a");
          if (allTocLinks !== undefined) {
            e.map(i => {
              if (i.isIntersecting && i.intersectionRatio >= 1) {
                allTocLinks.forEach(link => link.classList.remove("toc-active"));
                document.querySelector(`#toc li a[href="#${i.target.id}"]`).classList.add('toc-active')
              }
            })
          }
        };

        //make clicked toc item active and stop IntersectionObserver
        $("#toc a").click(function() {
          //stop tracking all h1-4 headings that have an id
          document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
            observer.unobserve(h);
          });
          var tocItems = $("#toc a");
          if (tocItems !== undefined) {
            for (let i = 0; i < tocItems.length; i++) {
              tocItems[i].classList.remove("toc-active");
            };
            this.classList.add("toc-active");
          }
        })
      })
    })
  </script>

  <!--handle page scroll top and bottom, add toc-active -->
  <script type="text/javascript">
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active")
          };
          tocItems[tocItems.length - 1].classList.add("toc-active");
        };
      //scroll to top
      if(window.pageYOffset === 0) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active");
          };
          tocItems[0].classList.add("toc-active");
        };
      })
  </script>

  <!--adjust sidebar and toc when footer is displayed -->
  <script type="text/javascript">
    sidebar = document.querySelector('.sidebar')
    toc = document.querySelector('#toc')
    main = document.querySelector('.main')
    okd_footer = document.querySelector('.footer-origin-docs')

    //handle short pages
    if (window.innerHeight === document.documentElement.scrollHeight) {
      //sidebar
      if (sidebar !== null && okd_footer == null) {
        sidebar.style.marginBottom = "38px";
        main.style.marginBottom = "35px";
      };
      //okd sidebar
      if(sidebar !== null && okd_footer !== null) {
        sidebar.style.marginBottom = "176px";
        main.style.marginBottom = "135px";
      }
    };

    //handle scrolling pages
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if ($(window).width() >= 1008) {
        if(sidebar !== null) {
          //pages with multiple toc entries
          if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
              //sidebar
              if (sidebar !== null && okd_footer == null){
                sidebar.style.marginBottom = "38px";
                main.style.marginBottom = "35px";
              };
              //toc
              if (toc !== null && okd_footer == null){
                toc.style.bottom = "35px";
              };
              //okd sidebar
              if(sidebar !== null && okd_footer !== null) {
                sidebar.style.marginBottom = "176px";
                main.style.marginBottom = "135px";
              };
              //okd toc
              if (toc !== null && okd_footer !== null){
                toc.style.bottom = "175px";
              };
            };
          if(document.documentElement.scrollHeight != window.pageYOffset + window.innerHeight) {
            sidebar.style.marginBottom = "0px";
            if (toc !== null) {
              toc.style.bottom = "0px";
            }
          }
        }
      }
    })
  </script>

  <!-- adjust alerts on mobile -->
  <script type="text/javascript">
    alert = document.querySelector('#support-alert')
    window.addEventListener("wheel", () => {
      if ($(window).width() < 1008) {
        //adjust alert
        if(window.pageYOffset > 0) {
          if(alert !== null) {
            document.querySelector('#support-alert').style.position = "fixed";
            document.querySelector('#support-alert').style.bottom = "0px";
            document.querySelector('#support-alert').style.margin = "5px";
            document.querySelector('#support-alert').style.zIndex = "9999999";
          }
        }
      }
   });
    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        if(alert !== null) {
          document.querySelector('#support-alert').style.removeProperty('position');
          document.querySelector('#support-alert').style.removeProperty('bottom');
          document.querySelector('#support-alert').style.removeProperty('margin');
          document.querySelector('#support-alert').style.removeProperty('zIndex');
        }
      }
    })
  </script>

</body>
</html>